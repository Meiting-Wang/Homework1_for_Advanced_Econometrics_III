\begin{lstlisting}
use nls80.dta, clear

local x "exper tenure educ married south urban black"
local zh "meduc feduc sibs"

*test rank condition
qui reg iq `x' `zh', vce(robust)
test `zh'
qui reg kww `x' `zh', vce(robust)
test `zh'

*output the regression result
eststo clear
eststo: reg lwage `x' iq, vce(robust)
eststo: reg lwage `x' kww, vce(robust)
eststo: ivregress 2sls lwage `x' (iq=`zh'), vce(robust)
eststo: ivregress 2sls lwage `x' (kww=`zh'), vce(robust) first
esttab *, b(3) se(3) star(* 0.10 ** 0.05 *** 0.01) r2 obslast compress nogaps mti("OLS" "OLS" "2SLS-iq" "2SLS-kww") order(iq kww educ)
\end{lstlisting}